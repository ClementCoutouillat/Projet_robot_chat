# Projet_robot_chat
Projet fait par Quentin Henriet, Bastien Chinianga, Jiang Kaixuan, Jangbo Wang et Clément Coutouillat
在这个项目中，我们需要完成一个两轮差分驱动的机器人来完成猫和老鼠的游戏。当机器人是猫时，它会追逐老鼠，当机器人是老鼠时，它会逃离猫。为了完成这个游戏，我们需要完成以下几个部分：
- 机器人能够在猫和老鼠的游戏中切换身份，当两个机器人发生碰撞时，它们的身份会发生变化--碰撞检测传感器
- 机器人能够在一个有边界的环境中移动，所以我们需要一个边界检测的传感器--边缘检测传感器
- 机器人能够检测到场地中的猫或者老鼠，所以我们需要一个传感器来检测场地中的物体--激光雷达传感器

## Ydlidar
* 我们使用YDLIDAR X4激光雷达来检测场地中的另一个机器人。
* 从YDLIDAR的数据手册中，我们知道YDLIDAR使用Uart进行通信，在开发手册中我们可以得到激光雷达的数据格式，如下图所示： 

当我们发送 A5 60 命令到激光雷达时，激光雷达会返回一帧数据，数据的格式如下图所示：

然后我们根据开发手册中的解析方法，得到机器人0-360度中的障碍物的角度和距离，从而得到另一个机器人的位置。

## 策略
在游戏中，当机器人是猫时，它会追逐老鼠，当机器人是老鼠时，它会逃离猫。所以针对机器人的不同身份，我们需要不同的策略来控制机器人的运动。
### Chat 策略
当机器人是猫时，它需要追逐老鼠，所以我们需要让机器人朝着老鼠的方向运动，首先我们通过计算机器人和老鼠的角度差来控制机器人向转到角度。当老鼠在0-180度之间时，我们让机器人向左转，当另一个机器人在180-360度之间时，我们让机器人向右转。当机器人转到正确的角度后，我们让机器人向前运动，直到机器人和老鼠发生碰撞，这时机器人的身份会发生变化，机器人变成老鼠，另一个机器人变成猫，然后我们就可以使用老鼠的策略来控制机器人的运动。
### Souris 策略
当机器人是老鼠时，它需要逃离猫，所以我们需要让机器人远离猫，当在机器人的50cm范围内有猫时且猫在0-180度之间时，我们让机器人向左转90读移动一段距离，然后再向右转90度移动一段距离，这样机器人就可以远离猫。当机器人和猫的距离大于50cm时，我们让机器人停止运动，当猫在180-360度之间时，我们让机器人向右转90度移动一段距离，然后再向左转90度移动一段距离，这样机器人就可以远离猫。当机器人和猫的距离大于50cm时，我们让机器人停止运动，当猫在180-360度之间时，我们让机器人向右转90度移动一段距离，然后再向左转90度移动一段距离，这样机器人就可以远离猫。 
## Motor
* 我们使用的是两轮差分驱动的机器人，所以我们需要控制机器人的左右轮的速度来控制机器人的运动。我们使用的是带有encoder的DC Geared Motor,它的最大转速300RPM 
### 前进
控制机器人的左右轮的速度相同，机器人就会直线运动。
### 转向
机器人的转向是通过控制机器人的左右轮的速度差来实现的，当机器人的左右轮的速度不同时，机器人会转向。
* 我们使用固定的速度来控制机器人的转向，当机器人需要向左转时，我们让机器人的左轮的速度为0，右轮的速度为最大速度，当机器人需要向右转时，我们让机器人的左轮的速度为最大速度，右轮的速度为0。转向需要的时间由下面的公式计算得到：

### 距离
机器人的距离是通过控制机器人运行的时间来实现的，当机器人运行的时间达到我们设定的时间时，机器人就会停止运动。从而实现机器人的距离控制。时间由下面的公式计算得到：
Timer = Distance / (WheelDiameter * PI) / Speed；
### 驱动
我们在对电机操作的代码中写了两个函数。一个是直接操控m改变电机的速度。为了使机器人更快的响应停止加速指令，其次我们也写了第二个asservissement的函数，使用pid算法控制电机的转动，每100ms会计算次当前的速度并进行feedback的返回速度让我们知道当前电机转动的速度，方便我们能够更精确的计算机器人的当前位置和运动的距离。PID控制器的输入是机器人的目标速度，输出是机器人的左右轮的速度。

## Border

## Contact
